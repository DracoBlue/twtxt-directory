<% content_for :title do %>
	twtxt user directory
<% end %>

<% content_for :header do %>

<script type='text/javascript'>
	var Ui = {
		add_user: function() {
			var form = $('#form-add-user');
			var button = $('#form-add-user input[type=submit]');
			
			var url = form.prop('action');
			var data = {
				username: $('#user-username').val(),
				url: $('#user-url').val()
			};

			button.prop('disabled', 'true');
			button.val('Adding...');
			$('#user-add-error').empty();

			$.post(url, data).done(function(response) {
				var result = 'user <a href="/user/' + response.user_id + '">@' + response.username + '</a> added!'
				$('#user-add-error').addClass('ok').html(result);
				Ui.activate_button(button);
			}).fail(function(xhr) {
				$('#user-add-error').removeClass('ok').html('could not add user: ' + xhr.responseText);
				Ui.activate_button(button);
			});
		},

		activate_button: function(button) {
			button.prop('disabled', false);
			button.val('Add User');
		}
	}

</script>

<% end %>

<% content_for :body do %>

<div class="section">
	<form id='form-add-user' action='/user/add' method='post' onsubmit='Ui.add_user();return false;'>
		@<input id='user-username' name='username' type="text" placeholder='username' />
		<input id='user-url' name='url' type="text"  placeholder='url' />
		<input type="submit" value='Add User' />
	</form>

	<div id='user-add-error' class='error-message'>
	</div>
</div>

<table class='console-table'>
	<tbody>
	<% users.each do |user| %>
		<tr>
			<td>
				<a class='user-link' href='/user/<%= user.user_id %>'>@<%= user.username %></a>
			</td>

			<td><a href='<%= user.update_url %>'><%= user.update_url.truncate(40) %></a></td>
			<td class='numeric'>[<%= user.update_count %> updates]</td>
		</tr>
	<% end %>
	</tbody>
</table>

<% end %>